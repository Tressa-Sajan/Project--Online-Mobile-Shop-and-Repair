{% load static %}

    <head>
        
                <title>ONLINE Mobile Shopping - Sign Up Page</title>        
                <link href="{% static 'css/bootstrap.min.css' %} " rel="stylesheet">
                <link href="{% static 'css/bootstrap-icons.css' %} " rel="stylesheet">
                <link rel="stylesheet" href="{% static 'css/slick.css' %} ">
                <link href="{% static 'css/tooplate-little-fashion.css' %} " rel="stylesheet">
            </head>
    
            <body>
                <style>
        body {
            background-image: url("{% static 'images/image.jpg' %}");
            background-size: cover; 
            background-repeat: no-repeat; 
            color:white;
        }
        .text-center, a {
            color:white; 
        }
        script, .registration-Form{
            color:red;
            font-style: italic;
            font-size: 18px;
        }
        
    </style>
                <main >
                      <div class="col-lg-8 mx-auto col-12"><br><br>
                            <center><h1>Sign Up</h1></center><br><br>
                            <div class="col-lg-8 col-11 mx-auto" >
                                <div class="card-body">
                                    <form id="registration-form" action="{% url 'signup' %}" method="post">
                                        {% csrf_token %}
                                        <div class="form-group">
                                            <label for="username" class="form-label">Username:</label>
                                            <input type="text" class="form-control" id="username" name="username" placeholder="Enter your username" required>
                                            <div class="form-error" id="usernameError"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="email" class="form-label">Email:</label>
                                            <input type="email" class="form-control" id="email" name="email" placeholder="Enter your email" required>
                                            <div class="form-error" id="emailError"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="password" class="form-label">Password:</label>
                                            <input type="password" class="form-control" id="password"name="password" placeholder="Enter your password" required>
                                            <div class="form-error" id="newPasswordError"></div>
                                        </div>
                                        <div class="form-group">
                                            <label for="ConfirmPassword" class="form-label">Confirm Password:</label>
                                            <input type="password" class="form-control" id="ConfirmPassword" name="ConfirmPassword" placeholder="Confirm your password" required>
                                            <div class="form-error" id="ConfirmPasswordError"></div>
                                        </div>
                                        <input type="submit" value="Create account" class="btn custom-btn form-control mt-4 mb-3">
                                        <p class="text-center">Already have an account? Please <a href="{% url 'login' %}">Sign In</a></p>
                                        <div class="form-error" id="general-error"></div>
                                        <div class="success-message" id="success-message"></div>
                                        <script>
                                            const registrationForm = document.getElementById("registration-form");
                                            registrationForm.addEventListener("submit", formEventHandler);
                                            
                                            const usernameInput = document.getElementById("username");
                                            const emailInput = document.getElementById("email"); // Define emailInput
                                            const newPasswordInput = document.getElementById("password");
                                            const confirmPasswordInput = document.getElementById("ConfirmPassword");
                                            
                                            var changeAttempt = 0;
                                            
                                            function formEventHandler(event) {
                                              event.preventDefault();
                                              var bool1 = validateUsername();cd 
                                              var bool2 = validateEmail();
                                              var bool3 = validatePassword();
                                              var bool4 = validateConfirmPassword();
                                            
                                              if (bool1 && bool2 && bool3 && bool4) {
                                                registrationForm.submit();
                                              }
                                            }
                                            
                                            document.addEventListener("DOMContentLoaded", function () {
                                              usernameInput.addEventListener("input", validateUsername);
                                              emailInput.addEventListener("input", validateEmail);
                                              newPasswordInput.addEventListener("input", validatePassword);
                                              confirmPasswordInput.addEventListener("input", validateConfirmPassword);
                                            });
                                            
                                            // E-Mail Validation
                                            function validateEmail() {
                                              const emailError = document.getElementById("emailError");
                                              const email = emailInput.value.trim();
                                              const regex = /^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/;
                                            
                                              if (!regex.test(email)) {
                                                emailError.classList.add("invalid-feedback");
                                                emailError.textContent = "Invalid email address.";
                                                emailInput.style.borderColor = "red";
                                                return false;
                                              } else if (email.length === 0) {
                                                emailError.classList.add("invalid-feedback");
                                                emailError.textContent = "This Field Cannot be Empty.";
                                                emailInput.style.borderColor = "red";
                                                return false;
                                              } else {
                                                let bool;
                                                fetch(`/check_user_exists/?email=${email}`)
                                                  .then((response) => response.json())
                                                  .then((data) => {
                                                    bool = data.exists;
                                                    // console.log(bool); // You can log it here to see the value.
                                            
                                                    if (!bool) {
                                                      emailError.className = "valid-feedback";
                                                      emailError.textContent = "Looks Good!";
                                                      emailInput.classList.remove("is-invalid");
                                                      emailInput.classList.add("is-valid");
                                                    } else {
                                                      emailError.classList.add("invalid-feedback");
                                                      emailError.textContent = "User Already Exists.";
                                                      emailInput.style.borderColor = "red";
                                                    }
                                                  });
                                                return true;
                                              }
                                            }
                                            // Password username
                                            function validateUsername() {
                                                const usernameError = document.getElementById("usernameError");
                                                const username = usernameInput.value;
                                                
                                                const regex = /^[a-zA-Z][a-zA-Z0-9_-]{2,19}$/;  // Setting Up Regular Expression
                                                const match = username.match(regex);
                                                // const noMatch = username.match(/\s/)
                                            
                                                if (!match) {
                                                    if (username.trim() === "") {
                                                        usernameError.classList.add("invalid-feedback");
                                                        usernameError.textContent = "*This Field Cannot be empty";
                                                        usernameInput.classList.add("is-invalid");
                                                        return false;
                                                    }else if (!username.match(/^[a-zA-Z]/)) {
                                                        usernameError.classList.add("invalid-feedback");
                                                        usernameError.textContent = "*Username must start with a letter.";
                                                        usernameInput.classList.add("is-invalid");
                                                        return false;
                                                    }else if (!username.match(/[a-zA-Z0-9_-]{2,19}$/)) {
                                                        usernameError.classList.add("invalid-feedback");
                                                        usernameError.textContent = "*Username must be between 3 and 20 characters and can only contain letters, numbers, underscores, or hyphens.";
                                                        usernameInput.classList.add("is-invalid");
                                                        return false;
                                                    }else if (username.match(/\s/)){
                                                        usernameError.classList.add("invalid-feedback");
                                                        usernameError.textContent = "*White Space Not Allowed";
                                                        usernameInput.classList.add("is-invalid");
                                                        return false;
                                                    }else{
                                                        usernameError.classList.add("invalid-feedback");
                                                        usernameError.textContent = "*Username must be between 3 and 20 characters and can only contain letters, numbers, underscores, or hyphens.";
                                                        usernameInput.classList.add("is-invalid");
                                                        return false;
                                                    }
                                                } else {
                                                    usernameError.className = "valid-feedback";
                                                    usernameError.textContent = "Looks Good!";
                                                    usernameInput.classList.remove("is-invalid");
                                                    usernameInput.classList.add("is-valid");
                                                    return true;
                                                }
                                            }
                                            
                                            //user exist
                                            function checkUserExists() {
                                                const username = document.getElementById('email').value;
                                                fetch(`/check_user_exists/?email=${username}`)
                                                    .then(response => response.json())
                                                    .then(data => {
                                                        // console.log(data);
                                                        if (data.exists) {
                                                            console.log(data);
                                                        } else {
                                                            alert('User does not exist. You can use this username.');
                                                        }
                                                    });
                                            }
                                            // Password Validation
                                            function validatePassword() {
                                                const newPasswordErrorDiv = document.getElementById("newPasswordError");
                                                const newPassword = newPasswordInput.value;
                                                const regex = /^(?=.[a-zA-Z])(?=.\d)(?=.[@$!%?&])[A-Za-z\d@$!%*?&]{8,}$/;
                                                const match = newPassword.match(regex);
                                            
                                                if (changeAttempt > 1)
                                                        validateConfirmPassword();
                                            
                                                if (!match){
                                                    if (newPassword.length == 0){
                                                        newPasswordErrorDiv.classList.add("invalid-feedback");
                                                        newPasswordErrorDiv.textContent = "*This Field Cannot be empty.";
                                                        newPasswordInput.classList.add("is-invalid");
                                                    }else if (newPassword.length < 8) {
                                                        newPasswordErrorDiv.classList.add("invalid-feedback");
                                                        newPasswordErrorDiv.textContent = "*Password must be at least 8 characters long.";
                                                        newPasswordInput.classList.add("is-invalid");
                                                    } else if (!/(?=.*[a-zA-Z])/.test(newPassword)) {
                                                        newPasswordErrorDiv.classList.add("invalid-feedback");
                                                        newPasswordErrorDiv.textContent = "*Password must contain at least one letter.";
                                                        newPasswordInput.classList.add("is-invalid");
                                                    } else if (!/(?=.*\d)/.test(newPassword)) {
                                                        newPasswordErrorDiv.classList.add("invalid-feedback");
                                                        newPasswordErrorDiv.textContent = "*Password must contain at least one digit.";
                                                        newPasswordInput.classList.add("is-invalid");
                                                    } else if (!/(?=.[@$!%?&])/.test(newPassword)) {
                                                        newPasswordErrorDiv.classList.add("invalid-feedback");
                                                        newPasswordErrorDiv.textContent = "*Password must contain at least one special character (@, $, !, %, *, ?, or &).";
                                                        newPasswordInput.classList.add("is-invalid");
                                                    }
                                                    return false;
                                                }else{
                                                    newPasswordErrorDiv.className = "valid-feedback";
                                                    newPasswordErrorDiv.textContent = "Looks Good!";
                                                    newPasswordInput.classList.remove("is-invalid");
                                                    newPasswordInput.classList.add("is-valid");
                                                    return true;
                                                }
                                            }
                                            
                                            // Confirm Password Validation
                                            function validateConfirmPassword() {
                                                const confirmPasswordErrorDiv = document.getElementById("ConfirmPasswordError")
                                                const newPassword = newPasswordInput.value;
                                                const confirmPassword = confirmPasswordInput.value;
                                                changeAttempt+=1;
                                            
                                            
                                                if (confirmPassword === newPassword && confirmPassword.length > 0){
                                                    confirmPasswordErrorDiv.className = "valid-feedback";
                                                    confirmPasswordErrorDiv.textContent = "Looks Good!";
                                                    confirmPasswordInput.classList.remove("is-invalid");
                                                    confirmPasswordInput.classList.add("is-valid");
                                                    return true;
                                                }else if(confirmPassword.length == 0){
                                                    confirmPasswordErrorDiv.classList.add("invalid-feedback");
                                                    confirmPasswordErrorDiv.textContent = "*This Field cannot be Empty.";
                                                    confirmPasswordInput.classList.add("is-invalid");
                                                    return false;
                                                }else{
                                                    confirmPasswordErrorDiv.classList.add("invalid-feedback");
                                                    confirmPasswordErrorDiv.textContent = "*Password Doesn't match";
                                                    confirmPasswordInput.classList.add("is-invalid");
                                                    return false;
                                                }
                                            }
                                            </script>
                                    </form>
                                </div>
                            
                                <!-- Add Bootstrap JS and jQuery CDN (optional) -->
                                <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
                                <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
                                <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
                                
                            </div>
                     </div>
                </main>
        
                <footer class="site-footer">
                    <div class="container">
                        <div class="row">
        
                            <div class="col-lg-3 col-10 me-auto mb-4">
                                <h4 class="text-white mb-3"><a href="index.html">ONLINE </a>Mobile Shopping</h4>
                                <p class="copyright-text text-muted mt-lg-5 mb-4 mb-lg-0">Copyright © 2022 <strong>ONLINE Mobile Shopping</strong></p>
                                <br>
                                <p class="copyright-text">Designed by Tressa</a></p>
                            </div>
        
                            <div class="col-lg-5 col-8">
                                <h5 class="text-white mb-3">Sitemap</h5>
        
                                <ul class="footer-menu d-flex flex-wrap">
                                    <li class="footer-menu-item"><a href="about.html" class="footer-menu-link">Story</a></li>
        
                                    <li class="footer-menu-item"><a href="#" class="footer-menu-link">Products</a></li>
        
                                    <li class="footer-menu-item"><a href="#" class="footer-menu-link">Privacy policy</a></li>
        
                                    <li class="footer-menu-item"><a href="#" class="footer-menu-link">FAQs</a></li>
        
                                    <li class="footer-menu-item"><a href="#" class="footer-menu-link">Contact</a></li>
                                </ul>
                            </div>
        
                            <div class="col-lg-3 col-4">
                                <h5 class="text-white mb-3">Social</h5>
        
                                <ul class="social-icon">
        
                                    <li><a href="#" class="social-icon-link bi-youtube"></a></li>
        
                                    <li><a href="#" class="social-icon-link bi-whatsapp"></a></li>
        
                                    <li><a href="#" class="social-icon-link bi-instagram"></a></li>
        
                                    <li><a href="#" class="social-icon-link bi-skype"></a></li>
                                </ul>
                            </div>
        
                        </div>
                    </div>
                </footer>
        
        <script src="{% static 'js/jquery.min.js' %} "></script>
        <script src="{% static 'js/bootstrap.bundle.min.js' %} "></script>
        <script src="{% static 'js/Headroom.js' %} "></script>
        <script src="{% static 'js/jQuery.headroom.js' %} "></script>
        <script src="{% static 'js/slick.min.js' %} "></script>
        <script src="{% static 'js/custom.js' %} "></script>

    </body>
</html>
{% comment "" %}<script src ="signup.js"><script>{% endcomment %}
